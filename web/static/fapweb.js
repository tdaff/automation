
/*jslint browser:true */

/** Take all the fields and create the fap file */
function generateFap() {
    "use strict";
    var fapfile = '#\n# .fap file generated by faps web UI\n#\n\n',
        formsCollection = document.getElementById('all-options'),
        r;

    for (r = 0; r < formsCollection.length; r += 1) {
        if (!formsCollection[r].disabled) {
            fapfile += formsCollection[r].id;
            fapfile += " = ";
            fapfile += formsCollection[r].value;
            fapfile += '\n';
        }
    }
    return fapfile;
}

function updateFap() {
    "use strict";
    var textArea = document.getElementById('generated-file');
    textArea.innerHTML = generateFap();
}

function switchActive(control) {
    "use strict";
    var input = document.getElementById(control);
    input.disabled = !input.disabled;
    updateFap();
}


/** upload file with AJAX */
function submitJob() {
    "use strict";
    var fileInput = document.getElementById('job-form'),
        formData = new FormData(fileInput),
        xhr = new XMLHttpRequest();

    xhr.open('post', '/submit', true);
    xhr.send(formData);
    /* do something after */
}

/** read in the file contents and inject into the page as a new script */
function viewCif() {
    "use strict";
    var fileInput = document.getElementById('cif-file').files[0],
        reader = new FileReader();

    reader.readAsText(fileInput, "UTF-8");
    reader.onload = function (evt) {
        var cifFile = evt.target.result,
            myCanvas = new ChemDoodle.TransformCanvas3D('view-cif', 500, 300),
            unitCell;

        myCanvas.emptyMessage = 'No Data Loaded!';
        myCanvas.specs.projectionPerspective_3D = false;
        myCanvas.specs.atoms_useJMOLColors = true;
        myCanvas.specs.bonds_useJMOLColors = true;

        cifFile = cifFile.replace(/(\r\n|\n|\t)/gm, "\n");
        cifFile = cifFile.replace(/[\'\"]/g, "\\$&");
        unitCell = ChemDoodle.readCIF(cifFile);
        myCanvas.loadMolecule(unitCell);
        myCanvas.repaint();
    };

}

